---
title: "GeneExpCor_Vignette"
author: "Felipe Barraza, Jon Blichar, Emmanuel Edu"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  word_document: default
vignette: |
  %\VignetteIndexEntry{Vignette Title} %\VignetteEngine{knitr::rmarkdown} %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
## Overview
This developing vignette is for the `geneExpCor` Rpackage which is capable of receiving tissue data and outputting correlation values corresponding to matching genes. Several functions are including that grant the user the capability to filter by variance percentage and by ligands. Main Functions:

- tissue_pair_expression()
- gene_names()
- var_filter()


## Dependencies
- `devtools`: https://cran.r-project.org/web/packages/devtools/index.html 
- `testthat`: https://testthat.r-lib.org/ Version 3.0 or above
- `WGCNA`: https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/ 
- `iemisc`: https://cran.rstudio.com/web/packages/iemisc/index.html 
- `dpylr`: https://www.tidyverse.org/ 
- `parallel`: https://stat.ethz.ch/R-manual/R-devel/library/parallel/doc/parallel.pdf 

## Installation

### 1. Installing From Github
After dependencies have been installed and loaded, installing `geneExpCor` from github requires the following line:  

 `devtools::install_github("Eziedu/Gene_Expression_Cors_JEF")`

### 1.2 Addressing Installation Errors
If there is an error with loading `devtools`, it is most likely due to a version issue. The devtools package uses the `testthat`package, and in order for devtools to run appropriately the loaded `testhat` package needs to be of version 3.0 or higher.

If a simple update does not solve the problem, run the following line to update `testthat`:

`install.packages("rlang", dependencies = c("Depends", "Imports", "LinkingTo", "Suggests"))`

Follow the installation process as you see fit, afterwards the `testthat` package should update to version 3.0 or above. 

### 2. Loading Necessary Data
To properly use the following functions, the inputted data needs to be in a specific format. To allow for easy testing, the package comes with two preinstalled tissue datasets: `subqAdipose_tissue_data` and `stomach_tissue_data`.

To properly access both datasets, we recommend attributing each set to a variable in the global enviornment. For example, run the following lines in the console: 
```{r}
tissue_1_data <- geneExpCor::subqAdipose_tissue_data
tissue_2_data <- geneExpCor::stomach_tissue_data
```
Addtionally a gene mapping dataset will need to be loaded to properly label gene names during analysis. This map is referred to as 'gene_map' and we recommend to load this data into the global enviornment. 

```{r}
gene_map <- geneExpCor::gencode_gene_map
```

The `gene_map` variable can now be used for susequent functions with the `ensembl_map` parameter. 

Now that the gene map and both tissue sets have been loaded in the global environment, they can be used as arguments to fulfill the `tissue_matrix` parameters for all functions in the package. 


## Formatting Data 

### gene_names() - Filtering Data to Identify Matching Genes 
To begin analysis the `gene_names` function will be used first. `gene_names()` takes in two tissue data sets and attempts to match the genes within both tissues and returns two matrices for each tissue with the matching genes. The `ensembl_map` parameter takes in a gene coding map to properly label the gene names in the dataset. 

```{r}
gene_names <- function(tissue_1_matrix,tissue_2_matrix,ensembl_map){
}
```
The outputted matrices are loaded in the global environment containing the matching donor and gene data present in both tissues. Therefore, both matricies have smaller dimensions than the original tissue data sets. 

The `final_tissue.matrix` matricies are in the proper form and can be used for `var_filter()` and `tissue_pair_expression()`.

## Functions

### Inuput Parameters
`tissue_1_matrix` - A matrix containing the tissue sample data of genes and donors.

`tissue_2_matrix` - A matrix containing the tissue sample data of genes and donors.

`ensembl_map` - Gene coding map

`percentage_variance` - A decimal input specifying variance percentage for analysis

## Output Variables
`final_tissue_1.matrix` - Matrix containing the matching genes and donors from orginial tissue sets

`final_tissue_2.matrix` - Matrix containing the matching genes and donors from orginial tissue sets

`variable.tissue_1.genes` - Filtered set of most variable genes according to `percentage_variance` in `var_filter()`

`variable.tissue_2.genes` - Filtered set of most variable genes according to `percentage_variance` in `var_filter()`

`gene_biweight_midcorrelation()` - Large matrix containing the biweight midcorrelation coefficients for both tissue sets

`pvalues_biweight` - Large matrix containing the pvalues for each gene across both tissues.

### var_filter() - Filtering for Most Variable Genes
To filter tissue matricies according to variance, the `var_filter` function should be utilized. This function takes two tissue matrices and a variance percentage and outputs matrices of the most variable genes for each tissue set. This function is primarily utilized with tissue sets containing matching genes and donors: `final_tissue_1.matrix`. 
 
 This function will return two lists of the most variable genes based on the `variance_percentage` parameter. 
```{r}
var_filter <- function(tissue_matrix_1,tissue_matrix_2, percentage_variance){
}
```
The outputted matricies `variable.tissue_1.genes` and `variable.tissue_2.genes` contain the most variable genes amongst both tissue sets and will therefore have smaller dimensions than the inputted tissue sets. 


### tissue_pair_gene_expression() - Conducting Biweight Midcorrelation Analysis
To conduct the biweight midcorrelation analysis on the tissue sets the `tissue_pair_gene_expression` function. 
This function takes in two tissue matrices and return two large matrices containing biweight midcorrelation coefficients and pvalues associated with both tissue sets. 
```{r}
tissue_pair_gene_expression <- function(tissue_1_matrix,tissue_2_matrix) {}
```

The outputted variables, `gene_biweight_midcorrelation` and `pvalues_biweight` are used to identify the corrlelations of the genes in both tissues matricies. 





